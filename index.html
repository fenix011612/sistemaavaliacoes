<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Avaliações</title>

<style>
:root{
  --lilas:#7b6cf6;
  --ciano:#00cfe8;
  --bg:#f4f6fb;
}

body{
  font-family: Arial, sans-serif;
  padding:20px;
  background:var(--bg);
}

h2,h3,h4{
  color:var(--lilas);
}

input, select, textarea{
  padding:10px;
  margin:6px 0;
  border-radius:6px;
  border:1px solid #ddd;
  width:100%;
  box-sizing:border-box;
}

button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:var(--lilas);
  color:white;
  transition:0.3s;
}

button:hover{
  background:var(--ciano);
}

.card{
  background:white;
  padding:15px;
  margin:12px 0;
  border-radius:10px;
  box-shadow:0 3px 10px rgba(0,0,0,0.08);
}

.hidden{
  display:none;
}

.topo{
  margin-bottom:20px;
}
</style>
</head>

<body>

<div id="telaInicial">

  <div class="topo">
    <h2>Sistema de Avaliações</h2>

    <input type="text" id="nome" placeholder="Nome do paciente">

    <select id="tipo">
      <option value="fisio">Fisio</option>
      <option value="pilates">Pilates</option>
      <option value="pelvica">Pélvica</option>
      <option value="recovery">Recovery</option>
    </select>

    <button onclick="salvar()">Salvar Avaliação</button>
    <button onclick="listar()">Listar Avaliações</button>
  </div>

  <div id="lista"></div>

</div>

<div id="telaDetalhe" class="hidden"></div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_AUTH_DOMAIN",
  databaseURL: "SEU_DATABASE_URL",
  projectId: "SEU_PROJECT_ID",
  storageBucket: "SEU_STORAGE_BUCKET",
  messagingSenderId: "SEU_SENDER_ID",
  appId: "SEU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.salvar = async function(){

  const nome = document.getElementById("nome").value;
  const tipo = document.getElementById("tipo").value;

  if(!nome){
    alert("Digite o nome!");
    return;
  }

  const novaRef = push(ref(db,"avaliacoes"));

  await set(novaRef,{
    nome,
    tipo,
    criadoEm: new Date().toLocaleString()
  });

  document.getElementById("nome").value="";
  listar();
}

window.listar = async function(){

  const lista = document.getElementById("lista");
  lista.innerHTML = "Carregando...";

  const snapshot = await get(ref(db,"avaliacoes"));

  if(!snapshot.exists()){
    lista.innerHTML = "Nenhuma avaliação encontrada.";
    return;
  }

  lista.innerHTML = "";

  snapshot.forEach(child=>{
    const dados = child.val();
    const id = child.key;

    lista.innerHTML += `
      <div class="card">
        <strong>${dados.nome}</strong><br>
        ${dados.tipo}<br>
        <small>${dados.criadoEm}</small><br><br>
        <button onclick="abrirAvaliacao('${id}')">Abrir</button>
      </div>
    `;
  });
}

window.abrirAvaliacao = async function(id){

  document.getElementById("telaInicial").classList.add("hidden");
  const tela = document.getElementById("telaDetalhe");
  tela.classList.remove("hidden");

  const snapshot = await get(ref(db,"avaliacoes/"+id));
  const dados = snapshot.val();

  tela.innerHTML = `
    <button onclick="voltar()">⬅ Voltar</button>

    <h3>${dados.nome} (${dados.tipo})</h3>
    <p><small>Criado em: ${dados.criadoEm}</small></p>

    <h4>Nova Evolução</h4>
    <textarea id="textoEvolucao" rows="5"></textarea>
    <button onclick="salvarEvolucao('${id}')">Salvar Evolução</button>

    <h4>Histórico</h4>
    <div id="historico"></div>
  `;

  carregarEvolucoes(id);
}

window.voltar = function(){
  document.getElementById("telaDetalhe").classList.add("hidden");
  document.getElementById("telaInicial").classList.remove("hidden");
}

window.salvarEvolucao = async function(id){

  const texto = document.getElementById("textoEvolucao").value;

  if(!texto){
    alert("Digite a evolução.");
    return;
  }

  const novaRef = push(ref(db,"avaliacoes/"+id+"/evolucoes"));

  await set(novaRef,{
    data: new Date().toLocaleString(),
    texto
  });

  document.getElementById("textoEvolucao").value="";
  carregarEvolucoes(id);
}

async function carregarEvolucoes(id){

  const historico = document.getElementById("historico");

  const snapshot = await get(ref(db,"avaliacoes/"+id+"/evolucoes"));

  if(!snapshot.exists()){
    historico.innerHTML = "Nenhuma evolução registrada.";
    return;
  }

  historico.innerHTML = "";

  snapshot.forEach(child=>{
    const dados = child.val();

    historico.innerHTML += `
      <div class="card">
        <strong>${dados.data}</strong><br><br>
        ${dados.texto}
      </div>
    `;
  });
}

</script>

</body>
</html>
