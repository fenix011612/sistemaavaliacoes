<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Avaliações</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --lilas:#7b6cf6;
  --ciano:#00cfe8;
  --fundo:#f4f6fb;
}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:var(--fundo);
}
header{
  background:linear-gradient(90deg,var(--lilas),var(--ciano));
  color:white;
  padding:20px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}
.container{
  padding:20px;
  max-width:900px;
  margin:auto;
}
.card{
  background:white;
  padding:20px;
  border-radius:15px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
  margin-bottom:20px;
}
input, select, textarea{
  width:100%;
  padding:10px;
  margin-top:8px;
  margin-bottom:15px;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  background:var(--lilas);
  color:white;
  border:none;
  padding:10px 15px;
  border-radius:8px;
  cursor:pointer;
}
button:hover{ opacity:0.9; }
.hidden{ display:none; }
.lista-item{
  padding:12px;
  border-bottom:1px solid #eee;
  cursor:pointer;
}
.lista-item:hover{ background:#f0f0ff; }
</style>
</head>
<body>

<header>Sistema de Avaliações</header>

<div class="container">

<!-- TELA INICIAL -->
<div id="telaInicial">

<div class="card">
<h3>Nova Avaliação</h3>

<input type="text" id="nome" placeholder="Nome do paciente">

<select id="tipo">
<option value="">Selecione o tipo</option>
<option value="Fisioterapia">Fisioterapia</option>
<option value="Pilates">Pilates</option>
<option value="Pélvica">Pélvica</option>
<option value="Recovery">Recovery</option>
</select>

<input type="date" id="data">

<button onclick="abrirTelaPorTipo()">Continuar</button>
</div>

<div class="card">
<h3>Avaliações Salvas</h3>

<select id="filtroTipo" onchange="carregarAvaliacoes()">
  <option value="">Todas</option>
  <option value="Fisioterapia">Fisioterapia</option>
  <option value="Pilates">Pilates</option>
  <option value="Pélvica">Pélvica</option>
  <option value="Recovery">Recovery</option>
</select>

<div id="listaAvaliacoes">Carregando...</div>
</div>

</div>

<!-- TELA FISIOTERAPIA -->
<div id="telaFisioterapia" class="hidden">
<div class="card">
<button onclick="voltar()">⬅ Voltar</button>
<h3>Avaliação Fisioterapia</h3>

<textarea id="fisio_queixa" placeholder="Queixa Principal"></textarea>
<textarea id="fisio_diag" placeholder="Diagnóstico"></textarea>
<textarea id="fisio_plano" placeholder="Plano Terapêutico"></textarea>

<button onclick="salvarFisioterapia()">Salvar</button>
</div>
</div>

<!-- TELA PILATES -->
<div id="telaPilates" class="hidden">
<div class="card">
<button onclick="voltar()">⬅ Voltar</button>
<h3>Avaliação Pilates</h3>

<textarea id="pilates_objetivo" placeholder="Objetivo"></textarea>
<textarea id="pilates_restricoes" placeholder="Restrições"></textarea>

<button onclick="salvarPilates()">Salvar</button>
</div>
</div>

<!-- TELA RECOVERY -->
<div id="telaRecovery" class="hidden">
<div class="card">
<button onclick="voltar()">⬅ Voltar</button>
<h3>Avaliação Recovery</h3>

<input type="text" id="recovery_tipo" placeholder="Tipo de Recovery">
<textarea id="recovery_obs" placeholder="Observações"></textarea>

<button onclick="salvarRecovery()">Salvar</button>
</div>
</div>

<!-- TELA PÉLVICA -->
<div id="telaPelvica" class="hidden">
<div class="card">
<button onclick="voltar()">⬅ Voltar</button>
<h3>Avaliação Pélvica</h3>

<textarea id="pelvica_queixa" placeholder="Queixa Pélvica"></textarea>
<textarea id="pelvica_hist" placeholder="Histórico"></textarea>

<button onclick="salvarPelvica()">Salvar</button>
</div>
</div>

<!-- TELA DETALHE -->
<div id="telaDetalhe" class="hidden">
<div class="card">
<button onclick="voltar()">⬅ Voltar</button>
<h3 id="tituloDetalhe"></h3>
<div id="dadosAvaliacao"></div>

<div id="evolucoes"></div>

<h4>Nova Evolução</h4>
<textarea id="textoEvolucao"></textarea>
<button onclick="salvarEvolucao()">Salvar Evolução</button>
</div>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAFNuEzaEvvpBKBGNG7NUf3zt74Q3r1fdo",
  authDomain: "sistemaavaliacoes-26513.firebaseapp.com",
  databaseURL: "https://sistemaavaliacoes-26513-default-rtdb.firebaseio.com",
  projectId: "sistemaavaliacoes-26513",
  storageBucket: "sistemaavaliacoes-26513.firebasestorage.app",
  messagingSenderId: "451297691104",
  appId: "1:451297691104:web:1f886ad169a54c4f8fd785"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let tempNome, tempTipo, tempData;
let avaliacaoAtualId = null;

/* ABRIR TELA POR TIPO */
window.abrirTelaPorTipo = function(){

tempNome = nome.value;
tempTipo = tipo.value;
tempData = data.value;

if(!tempNome || !tempTipo || !tempData){
alert("Preencha todos os campos.");
return;
}

telaInicial.classList.add("hidden");

document.getElementById("tela"+tempTipo.replace("ç","c").replace("é","e")).classList.remove("hidden");
};

/* SALVAMENTOS */
function salvarBase(dadosExtras){

const novaRef = push(ref(db,"avaliacoes"));

set(novaRef,{
nome: tempNome,
tipo: tempTipo,
data: tempData,
...dadosExtras,
criadoEm:new Date().toLocaleString()
});

alert("Avaliação salva!");
voltar();
}

window.salvarFisioterapia = function(){
salvarBase({
queixa:fisio_queixa.value,
diagnostico:fisio_diag.value,
plano:fisio_plano.value
});
};

window.salvarPilates = function(){
salvarBase({
objetivo:pilates_objetivo.value,
restricoes:pilates_restricoes.value
});
};

window.salvarRecovery = function(){
salvarBase({
tipoRecovery:recovery_tipo.value,
obs:recovery_obs.value
});
};

window.salvarPelvica = function(){
salvarBase({
queixa:pelvica_queixa.value,
historico:pelvica_hist.value
});
};

/* LISTA */
window.carregarAvaliacoes = function(){

const filtro = filtroTipo.value;

onValue(ref(db,"avaliacoes"),(snapshot)=>{

listaAvaliacoes.innerHTML="";

if(!snapshot.exists()){
listaAvaliacoes.innerHTML="Nenhuma avaliação.";
return;
}

snapshot.forEach((child)=>{
const dados=child.val();
if(filtro && dados.tipo !== filtro) return;

const div=document.createElement("div");
div.className="lista-item";
div.innerHTML=`<strong>${dados.nome}</strong> - ${dados.tipo}`;
div.onclick=()=>abrirDetalhe(child.key,dados);
listaAvaliacoes.appendChild(div);
});
});
};

window.abrirDetalhe=function(id,dados){

avaliacaoAtualId=id;

telaInicial.classList.add("hidden");
telaDetalhe.classList.remove("hidden");

tituloDetalhe.innerText=`${dados.nome} - ${dados.tipo}`;

let html=`<p><strong>Data:</strong> ${dados.data}</p>`;

for (const key in dados){
if(!["nome","tipo","data","criadoEm"].includes(key)){
html+=`<p><strong>${key}:</strong> ${dados[key]}</p>`;
}
}

dadosAvaliacao.innerHTML=html;
carregarEvolucoes();
};

function carregarEvolucoes(){

evolucoes.innerHTML="<h4>Evoluções</h4>";

onValue(ref(db,`avaliacoes/${avaliacaoAtualId}/evolucoes`),(snapshot)=>{
if(!snapshot.exists()){
evolucoes.innerHTML+="Nenhuma evolução.";
return;
}
snapshot.forEach((child)=>{
const evo=child.val();
evolucoes.innerHTML+=`
<p><strong>${evo.data}</strong><br>${evo.texto}<hr></p>`;
});
});
}

window.salvarEvolucao=function(){

if(!textoEvolucao.value) return;

const novaRef=push(ref(db,`avaliacoes/${avaliacaoAtualId}/evolucoes`));

set(novaRef,{
texto:textoEvolucao.value,
data:new Date().toLocaleDateString()
});

textoEvolucao.value="";
};

window.voltar=function(){

telaInicial.classList.remove("hidden");
telaFisioterapia.classList.add("hidden");
telaPilates.classList.add("hidden");
telaRecovery.classList.add("hidden");
telaPelvica.classList.add("hidden");
telaDetalhe.classList.add("hidden");
};

carregarAvaliacoes();

</script>
</body>
</html>





