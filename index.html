<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Avalia√ß√µes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #f4f6ff, #eef2ff);
  margin: 0;
  padding: 20px;
}

.container {
  max-width: 750px;
  margin: auto;
  background: white;
  padding: 25px;
  border-radius: 20px;
  box-shadow: 0 15px 40px rgba(0,0,0,0.08);
}

h2 {
  text-align: center;
  margin-bottom: 20px;
}

.hidden { display: none; }

button {
  padding: 8px 14px;
  margin: 5px 3px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
}

.primary { background:#6c63ff; color:white; }
.secondary { background:#e4e6ff; }
.success { background:#00c896; color:white; }

input, select, textarea {
  width: 100%;
  padding: 8px;
  margin: 6px 0;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.card {
  background:#f8f9ff;
  padding:15px;
  margin:10px 0;
  border-radius:15px;
  box-shadow:0 8px 20px rgba(0,0,0,0.05);
}
</style>
</head>

<body>
<div class="container">

<h2>Sistema de Avalia√ß√µes</h2>

<!-- MENU -->
<div id="menu">
<button class="primary" onclick="mostrarFormulario()">Nova Avalia√ß√£o</button>
<button class="secondary" onclick="mostrarLista()">Ver Avalia√ß√µes</button>
</div>

<!-- FORM -->
<div id="formulario" class="hidden">
<h3>Nova Avalia√ß√£o</h3>

<form onsubmit="salvar(event)">
<input name="nome" placeholder="Nome do paciente" required>

<select name="tipo" required>
<option value="">Selecione o tipo</option>
<option value="fisio">Fisioterapia</option>
<option value="pilates">Pilates</option>
<option value="pelvica">P√©lvica</option>
<option value="recovery">Recovery</option>
</select>

<!-- üîΩ ESPA√áOS RESERVADOS PARA MODELOS FUTUROS -->

<div id="modelo-fisio" class="hidden">
<!-- Aqui futuramente entra o formul√°rio completo de Fisioterapia -->
</div>

<div id="modelo-pilates" class="hidden">
<!-- Aqui futuramente entra o formul√°rio completo de Pilates -->
</div>

<div id="modelo-pelvica" class="hidden">
<!-- Aqui futuramente entra o formul√°rio completo de P√©lvica -->
</div>

<div id="modelo-recovery" class="hidden">
<!-- Aqui futuramente entra o formul√°rio completo de Recovery -->
</div>

<button class="success" type="submit">Salvar</button>
</form>

<button class="secondary" onclick="voltarMenu()">Voltar</button>
</div>

<!-- LISTA -->
<div id="lista" class="hidden">
<h3>Avalia√ß√µes</h3>

<input id="filtroNome" placeholder="Buscar por nome..." oninput="carregar()">

<select id="filtroTipo" onchange="carregar()">
<option value="">Todos</option>
<option value="fisio">Fisio</option>
<option value="pilates">Pilates</option>
<option value="pelvica">P√©lvica</option>
<option value="recovery">Recovery</option>
</select>

<div id="listaContainer"></div>

<button class="secondary" onclick="voltarMenu()">Voltar</button>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAFNuEzaEvvpBKBGNG7NUf3zt74Q3r1fdo",
  authDomain: "sistemaavaliacoes-26513.firebaseapp.com",
  databaseURL: "https://sistemaavaliacoes-26513-default-rtdb.firebaseio.com",
  projectId: "sistemaavaliacoes-26513",
  storageBucket: "sistemaavaliacoes-26513.firebasestorage.app",
  messagingSenderId: "451297691104",
  appId: "1:451297691104:web:1f886ad169a54c4f8fd785"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* NAVEGA√á√ÉO */

window.mostrarFormulario = function(){
  menu.classList.add("hidden");
  formulario.classList.remove("hidden");
}

window.mostrarLista = function(){
  menu.classList.add("hidden");
  lista.classList.remove("hidden");
  carregar();
}

window.voltarMenu = function(){
  menu.classList.remove("hidden");
  formulario.classList.add("hidden");
  lista.classList.add("hidden");
}

/* SALVAR */

window.salvar = function(e){
  e.preventDefault();

  const dados = Object.fromEntries(new FormData(e.target));
  dados.criadoEm = new Date().toLocaleString();

  push(ref(db, `avaliacoes/${dados.tipo}`), dados)
  .then(()=>{
    alert("‚úÖ Avalia√ß√£o salva!");
    e.target.reset();
    voltarMenu();
  });
}

/* CARREGAR */

window.carregar = function(){

  const listaDiv = document.getElementById("listaContainer");
  const filtroNome = document.getElementById("filtroNome").value.toLowerCase();
  const filtroTipo = document.getElementById("filtroTipo").value;

  listaDiv.innerHTML = "Carregando...";

  const tipos = ["fisio","pilates","pelvica","recovery"];
  listaDiv.innerHTML = "";

  tipos.forEach(tipo => {

    if(filtroTipo && filtroTipo !== tipo) return;

    onValue(ref(db, `avaliacoes/${tipo}`), snapshot => {

      if(!snapshot.exists()) return;

      snapshot.forEach(child => {

        const id = child.key;
        const dados = child.val();

        if(filtroNome && !dados.nome.toLowerCase().includes(filtroNome)) return;

        listaDiv.innerHTML += `
          <div class="card">
            <strong>${dados.nome}</strong><br>
            Tipo: ${tipo}<br>
            <small>${dados.criadoEm}</small><br><br>
            <button onclick="mostrarEvolucoes('${tipo}','${id}')">Ver Evolu√ß√µes</button>
            <button onclick="adicionarEvolucao('${tipo}','${id}')">Adicionar Evolu√ß√£o</button>
            <div id="evolucoes-${id}"></div>
          </div>
        `;
      });

    });

  });

}

/* EVOLU√á√ÉO */

window.adicionarEvolucao = function(tipo,id){

  const texto = prompt("Digite a evolu√ß√£o do dia:");
  if(!texto) return;

  push(ref(db, `avaliacoes/${tipo}/${id}/evolucoes`), {
    data: new Date().toLocaleString(),
    texto
  });

}

window.mostrarEvolucoes = function(tipo,id){

  const div = document.getElementById(`evolucoes-${id}`);
  div.innerHTML = "Carregando...";

  onValue(ref(db, `avaliacoes/${tipo}/${id}/evolucoes`), snapshot => {

    div.innerHTML = "";

    if(!snapshot.exists()){
      div.innerHTML = "<small>Sem evolu√ß√µes ainda.</small>";
      return;
    }

    snapshot.forEach(child => {
      const evo = child.val();

      div.innerHTML += `
        <div style="margin-top:6px;padding:8px;background:#eef2ff;border-radius:8px;">
          <small><strong>${evo.data}</strong></small><br>
          ${evo.texto}
        </div>
      `;
    });

  });

}

</script>

</body>
</html>



