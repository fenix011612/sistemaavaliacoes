<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Avaliações</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --lilas:#7b6cf6;
  --ciano:#00cfe8;
  --fundo:#f4f6fb;
}

body{
  margin:0;
  font-family:Arial, sans-serif;
  background:var(--fundo);
}

header{
  background:linear-gradient(90deg,var(--lilas),var(--ciano));
  color:white;
  padding:20px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}

.container{
  padding:20px;
  max-width:900px;
  margin:auto;
}

.card{
  background:white;
  padding:20px;
  border-radius:15px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
  margin-bottom:20px;
}

input, select, textarea{
  width:100%;
  padding:10px;
  margin-top:8px;
  margin-bottom:15px;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  background:var(--lilas);
  color:white;
  border:none;
  padding:10px 15px;
  border-radius:8px;
  cursor:pointer;
  margin-right:5px;
}

button:hover{ opacity:0.9; }

.hidden{ display:none; }

.lista-item{
  padding:12px;
  border-bottom:1px solid #eee;
  cursor:pointer;
}

.lista-item:hover{
  background:#f0f0ff;
}
</style>
</head>
<body>

<header>Sistema de Avaliações</header>

<div class="container">

<!-- TELA INICIAL -->
<div id="telaInicial">

<div class="card">
<h3>Nova Avaliação</h3>

<input type="text" id="nome" placeholder="Nome do paciente">

<select id="tipo">
<option value="Fisioterapia">Fisioterapia</option>
<option value="Pilates">Pilates</option>
<option value="Pélvica">Pélvica</option>
<option value="Recovery">Recovery</option>
</select>

<input type="date" id="data">

<button onclick="salvarAvaliacao()">Salvar Avaliação</button>
</div>

<div class="card">
<h3>Avaliações Salvas</h3>
<div id="listaAvaliacoes">Carregando...</div>
</div>

</div>

<!-- TELA DETALHE -->
<div id="telaDetalhe" class="hidden">
<div class="card">

<button onclick="voltar()">⬅ Voltar</button>

<h3 id="tituloDetalhe"></h3>

<div id="evolucoes"></div>

<h4>Nova Evolução</h4>
<textarea id="textoEvolucao" rows="6" placeholder="Digite a evolução..."></textarea>
<button onclick="salvarEvolucao()">Salvar Evolução</button>

</div>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAFNuEzaEvvpBKBGNG7NUf3zt74Q3r1fdo",
  authDomain: "sistemaavaliacoes-26513.firebaseapp.com",
  databaseURL: "https://sistemaavaliacoes-26513-default-rtdb.firebaseio.com",
  projectId: "sistemaavaliacoes-26513",
  storageBucket: "sistemaavaliacoes-26513.firebasestorage.app",
  messagingSenderId: "451297691104",
  appId: "1:451297691104:web:1f886ad169a54c4f8fd785"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let avaliacaoAtualId = null;

/* SALVAR AVALIAÇÃO */
window.salvarAvaliacao = function(){

  const nome = document.getElementById("nome").value;
  const tipo = document.getElementById("tipo").value;
  const data = document.getElementById("data").value;

  if(!nome || !data){
    alert("Preencha nome e data.");
    return;
  }

  const novaRef = push(ref(db, "avaliacoes"));

  set(novaRef,{
    nome,
    tipo,
    data,
    criadoEm: new Date().toLocaleString()
  });

  alert("Avaliação salva!");
  document.getElementById("nome").value="";
  document.getElementById("data").value="";
};

/* CARREGAR AVALIAÇÕES */
function carregarAvaliacoes(){

  const lista = document.getElementById("listaAvaliacoes");
  lista.innerHTML = "Carregando...";

  const avalRef = ref(db, "avaliacoes");

  onValue(avalRef, (snapshot) => {

    lista.innerHTML = "";

    if (!snapshot.exists()) {
      lista.innerHTML = "Nenhuma avaliação encontrada.";
      return;
    }

    snapshot.forEach((child) => {

      const dados = child.val();

      const div = document.createElement("div");
      div.className = "lista-item";
      div.innerHTML = `<strong>${dados.nome}</strong> - ${dados.tipo}`;
      div.onclick = () => abrirDetalhe(child.key, dados);

      lista.appendChild(div);

    });

  });
}

/* ABRIR DETALHE */
window.abrirDetalhe = function(id,dados){

  avaliacaoAtualId = id;

  document.getElementById("telaInicial").classList.add("hidden");
  document.getElementById("telaDetalhe").classList.remove("hidden");

  document.getElementById("tituloDetalhe").innerText =
  `${dados.nome} - ${dados.tipo}`;

  carregarEvolucoes();
};

/* CARREGAR EVOLUÇÕES */
function carregarEvolucoes(){

  const div = document.getElementById("evolucoes");
  div.innerHTML = "<h4>Evoluções</h4>";

  const refEvo = ref(db, `avaliacoes/${avaliacaoAtualId}/evolucoes`);

  onValue(refEvo, (snapshot) => {

    div.innerHTML = "<h4>Evoluções</h4>";

    if(!snapshot.exists()){
      div.innerHTML += "Nenhuma evolução.";
      return;
    }

    snapshot.forEach((child)=>{
      const evo = child.val();

      const p = document.createElement("p");
      p.innerHTML = `<strong>${evo.data}</strong><br>${evo.texto}<hr>`;
      div.appendChild(p);
    });

  });
}

/* SALVAR EVOLUÇÃO */
window.salvarEvolucao = function(){

  const texto = document.getElementById("textoEvolucao").value;

  if(!texto){
    alert("Digite a evolução.");
    return;
  }

  const novaRef = push(ref(db, `avaliacoes/${avaliacaoAtualId}/evolucoes`));

  set(novaRef,{
    texto,
    data: new Date().toLocaleDateString()
  });

  document.getElementById("textoEvolucao").value="";
};

/* VOLTAR */
window.voltar = function(){
  document.getElementById("telaInicial").classList.remove("hidden");
  document.getElementById("telaDetalhe").classList.add("hidden");
};

/* INICIAR */
carregarAvaliacoes();

</script>

</body>
</html>



