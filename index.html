<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Avalia√ß√µes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f9;
  margin:0;
  padding:20px;
}

h1{
  text-align:center;
}

.container{
  max-width:1000px;
  margin:auto;
}

.card{
  background:#fff;
  padding:15px;
  margin-top:15px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
}

button{
  padding:8px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin:4px 2px;
}

.salvar{ background:#28a745; color:white; }
.voltar{ background:#6c757d; color:white; }
.filtro{ background:#007bff; color:white; }

input, select{
  padding:8px;
  margin:5px 0;
  width:100%;
  border-radius:6px;
  border:1px solid #ccc;
}

.hidden{ display:none; }

.evolucao-box{
  background:#f1f1f1;
  padding:8px;
  border-radius:6px;
  margin-top:5px;
}
</style>
</head>
<body>

<div class="container">

<h1>Sistema de Avalia√ß√µes</h1>

<button onclick="mostrarCadastro()">Nova Avalia√ß√£o</button>
<button onclick="carregar()">Ver Avalia√ß√µes</button>

<!-- CADASTRO -->
<div id="telaCadastro" class="card hidden">
  <h3>Nova Avalia√ß√£o</h3>

  <input type="text" id="nome" placeholder="Nome do paciente/aluno">

  <select id="tipo">
    <option value="fisio">Fisioterapia</option>
    <option value="pilates">Pilates</option>
    <option value="pelvica">P√©lvica</option>
    <option value="recovery">Recovery</option>
  </select>

  <!-- ESPA√áOS SEPARADOS PARA MODELOS FUTUROS -->
  <div id="modelo-fisio"></div>
  <div id="modelo-pilates"></div>
  <div id="modelo-pelvica"></div>
  <div id="modelo-recovery"></div>

  <button class="salvar" onclick="salvar()">Salvar</button>
  <button class="voltar" onclick="voltar()">Cancelar</button>
</div>

<!-- FILTROS -->
<div id="telaLista" class="card hidden">
  <h3>Pesquisar Avalia√ß√µes</h3>

  <input type="text" id="filtroNome" placeholder="Buscar por nome">
  
  <select id="filtroTipo">
    <option value="">Todos os tipos</option>
    <option value="fisio">Fisioterapia</option>
    <option value="pilates">Pilates</option>
    <option value="pelvica">P√©lvica</option>
    <option value="recovery">Recovery</option>
  </select>

  <button class="filtro" onclick="carregar()">Filtrar</button>

  <div id="listaContainer"></div>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAFNuEzaEvvpBKBGNG7NUf3zt74Q3r1fdo",
  authDomain: "sistemaavaliacoes-26513.firebaseapp.com",
  databaseURL: "https://sistemaavaliacoes-26513-default-rtdb.firebaseio.com",
  projectId: "sistemaavaliacoes-26513",
  storageBucket: "sistemaavaliacoes-26513.firebasestorage.app",
  messagingSenderId: "451297691104",
  appId: "1:451297691104:web:1f886ad169a54c4f8fd785"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

console.log("üî• Firebase conectado!");

window.mostrarCadastro = function(){
  document.getElementById("telaCadastro").classList.remove("hidden");
  document.getElementById("telaLista").classList.add("hidden");
}

window.voltar = function(){
  document.getElementById("telaCadastro").classList.add("hidden");
}

window.salvar = function(){

  const nome = document.getElementById("nome").value;
  const tipo = document.getElementById("tipo").value;

  if(!nome){
    alert("Digite o nome!");
    return;
  }

  const novaRef = push(ref(db, `avaliacoes/${tipo}`));

  set(novaRef,{
    nome,
    criadoEm: new Date().toLocaleString()
  });

  alert("Salvo com sucesso!");
  voltar();
}

window.carregar = function(){

  document.getElementById("telaLista").classList.remove("hidden");
  document.getElementById("telaCadastro").classList.add("hidden");

  const listaDiv = document.getElementById("listaContainer");
  listaDiv.innerHTML = "Carregando...";

  const filtroNome = document.getElementById("filtroNome").value.toLowerCase();
  const filtroTipo = document.getElementById("filtroTipo").value;

  const tipos = ["fisio","pilates","pelvica","recovery"];

  let todas = [];
  let carregados = 0;

  tipos.forEach(tipo => {

    onValue(ref(db, `avaliacoes/${tipo}`), snapshot => {

      carregados++;

      if(snapshot.exists()){
        snapshot.forEach(child => {
          todas.push({
            id: child.key,
            tipo: tipo,
            ...child.val()
          });
        });
      }

      if(carregados === tipos.length){
        renderizar(todas, filtroNome, filtroTipo);
      }

    }, { onlyOnce:true });

  });

}

function renderizar(lista, filtroNome, filtroTipo){

  const listaDiv = document.getElementById("listaContainer");
  listaDiv.innerHTML = "";

  const filtradas = lista.filter(item => {
    if(filtroTipo && item.tipo !== filtroTipo) return false;
    if(filtroNome && !item.nome.toLowerCase().includes(filtroNome)) return false;
    return true;
  });

  if(filtradas.length === 0){
    listaDiv.innerHTML = "Nenhuma avalia√ß√£o encontrada.";
    return;
  }

  filtradas.forEach(dados => {

    listaDiv.innerHTML += `
      <div class="card">
        <strong>${dados.nome}</strong><br>
        Tipo: ${dados.tipo}<br>
        <small>${dados.criadoEm}</small><br><br>

        <button onclick="adicionarEvolucao('${dados.tipo}','${dados.id}')">Adicionar Evolu√ß√£o</button>

        <div id="evolucoes-${dados.id}"></div>
      </div>
    `;

  });

}

window.adicionarEvolucao = function(tipo,id){

  const texto = prompt("Digite a evolu√ß√£o:");
  if(!texto) return;

  const evolucaoRef = push(ref(db, `avaliacoes/${tipo}/${id}/evolucoes`));

  set(evolucaoRef,{
    texto,
    data: new Date().toLocaleString()
  });

  alert("Evolu√ß√£o adicionada!");
}

</script>

</body>
</html>




