<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Avalia√ß√µes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial;
  max-width: 600px;
  margin: auto;
  padding: 20px;
}
.hidden { display: none; }
button {
  padding: 8px 12px;
  margin: 5px 0;
  cursor: pointer;
}
input, select {
  width: 100%;
  padding: 6px;
  margin: 5px 0;
}
.card {
  border: 1px solid #ccc;
  padding: 10px;
  margin: 8px 0;
  border-radius: 6px;
}
</style>
</head>
<body>

<h2>Sistema de Avalia√ß√µes</h2>

<!-- MENU -->
<div id="menu">
<button onclick="mostrarFormulario()">Nova Avalia√ß√£o</button>
<button onclick="mostrarLista()">Ver Avalia√ß√µes</button>
</div>

<!-- FORM -->
<div id="formulario" class="hidden">
<h3>Nova Avalia√ß√£o</h3>

<form onsubmit="salvar(event)">
<input name="nome" placeholder="Nome do paciente" required>

<select name="tipo" required>
<option value="">Selecione o tipo</option>
<option value="fisio">Fisioterapia</option>
<option value="pilates">Pilates</option>
<option value="pelvica">P√©lvica</option>
<option value="recovery">Recovery</option>
</select>

<button type="submit">Salvar</button>
</form>

<button onclick="voltarMenu()">Voltar</button>
</div>

<!-- LISTA -->
<div id="lista" class="hidden">
<h3>Avalia√ß√µes Salvas</h3>
<div id="listaContainer"></div>
<button onclick="voltarMenu()">Voltar</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

/* üî• SEU FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyAFNuEzaEvvpBKBGNG7NUf3zt74Q3r1fdo",
  authDomain: "sistemaavaliacoes-26513.firebaseapp.com",
  databaseURL: "https://sistemaavaliacoes-26513-default-rtdb.firebaseio.com",
  projectId: "sistemaavaliacoes-26513",
  storageBucket: "sistemaavaliacoes-26513.firebasestorage.app",
  messagingSenderId: "451297691104",
  appId: "1:451297691104:web:1f886ad169a54c4f8fd785"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

console.log("üî• Firebase conectado com sucesso!");

/* ===== NAVEGA√á√ÉO ===== */

window.mostrarFormulario = function(){
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("formulario").classList.remove("hidden");
}

window.mostrarLista = function(){
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("lista").classList.remove("hidden");
  carregar();
}

window.voltarMenu = function(){
  document.getElementById("menu").classList.remove("hidden");
  document.getElementById("formulario").classList.add("hidden");
  document.getElementById("lista").classList.add("hidden");
}

/* ===== SALVAR ===== */

window.salvar = function(e){
  e.preventDefault();

  const dados = Object.fromEntries(new FormData(e.target));
  dados.criadoEm = new Date().toLocaleString();

  push(ref(db, "avaliacoes"), dados)
    .then(()=>{
      alert("‚úÖ Avalia√ß√£o salva!");
      e.target.reset();
      voltarMenu();
    })
    .catch((erro)=>{
      alert("Erro ao salvar: " + erro.message);
    });
}

/* ===== CARREGAR ===== */

function carregar(){

  const lista = document.getElementById("listaContainer");
  lista.innerHTML = "Carregando...";

  onValue(ref(db, "avaliacoes"), snapshot => {

    lista.innerHTML = "";

    if(!snapshot.exists()){
      lista.innerHTML = "Nenhuma avalia√ß√£o encontrada.";
      return;
    }

    snapshot.forEach(child => {
      const dados = child.val();

      lista.innerHTML += `
        <div class="card">
          <strong>${dados.nome}</strong><br>
          Tipo: ${dados.tipo}<br>
          <small>${dados.criadoEm}</small>
        </div>
      `;
    });

  });

}

</script>

</body>
</html>

